<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>注册-大圣网</title>
    <link rel="stylesheet" href="./css/sign_in.css">
</head>

<body class="zhi  no-auth">
    <div class="index-main">
        <div class="index-main-body">
            <div class="index-header">

                <a href="/"><h1 class="logo hide-text"></h1></a>

                <h2 class="subtitle">一入前端深似海，从此红尘陌路人</h2>
            </div>

            <div class="desk-front sign-flow clearfix sign-flow-simple">

                <div class="index-tab-navs">
                    <div class="navs-slider" data-active-index="0">
                        <a href="/sign_up" class="active">注册</a>
                        <a href="/sign_in">登录</a>
                        <span class="navs-slider-bar"></span>
                    </div>
                </div>

                <div class="view view-signup selected" data-za-module="SignUpForm">
                    <div class="zu-side-login-box">
                        <input type="password" hidden="">
                        <input type="hidden" name="_xsrf" value="6a621c80d920f62870cf5fb6694d8be6">
                        <div class="group-inputs">
                            <div class="name input-wrapper">
                                <input  required="" type="text" id="username" aria-label="姓名" placeholder="姓名">
                            </div>
                            <div class="email input-wrapper">
                                <input  required="" type="text" class="account" id="callphone" aria-label="手机号" placeholder="手机号">
                            </div>

                            <div class="input-wrapper">
                                <input required="" type="password" id="password" aria-label="密码" placeholder="密码（不少于 6 位）" autocomplete="off">
                            </div>
                        </div>
                        <div class="button-wrapper command">
                            <button class="sign-button submit">注册大圣</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
    <script src="js/libs/zepto.min.js"></script>
    <script>

        function signup(){
            let username = $('#username').val(),
            callphone = $('#callphone').val(),
            password = btoa($('#password').val());
            $.ajax({
                url:'/data/signup',
                type:'post',
                data:{
                    username,
                    callphone,
                    password
                },
                success(res){
                    alert(res.desc)
                    if(res.code == '1'){
                        accessToken = res.data.accessToken
                        localStorage.setItem('accessToken', accessToken)
                        location.href='/index.html'
                    }
                },
                error(err){
                    console.log(err)
                }
            })

        }
        $('body').bind('keypress', function(event) {  
            if (event.keyCode == "13") {              
                event.preventDefault();   
                signup()
            }  
        }); 

        $('button').click(signup)
    </script>
</body>

</html>